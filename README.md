# Lung-Nodule-Classification-Project
这是一个基于深度学习的肺部结节侵袭性分类系统，结合3D医学影像与放射组学特征进行多模态分析。项目提供完整的数据可视化、模型训练和评估流程，专门针对医学影像数据的特点进行了优化。
A deep learning-based lung nodule invasiveness classification system that combines 3D medical imaging with radiomics features for multimodal analysis. The project provides a complete pipeline for data visualization, model training, and evaluation, specifically optimized for medical imaging data characteristics.


lung-nodule-classification/
├── 📊 GetData.py              # 数据加载和可视化工具
├── 🤖 TrainModel.py           # 模型训练和评估主程序
├── 📁 utils/                  # 工具函数目录
├── 📁 config/                 # 配置文件目录
├── 📁 data/                   # 数据目录（需要自行添加）
├── 📁 models/                 # 模型保存目录（训练后生成）
├── 📁 results/                # 训练结果目录（训练后生成）
├── 📄 requirements.txt        # 依赖包列表
└── 📄 README.md              # 项目说明文档

# 创建conda环境
conda create -n lung-nodule python=3.8
conda activate lung-nodule

# 安装依赖
pip install -r requirements.txt

torch==1.13.0
torchvision==0.14.0
nibabel==4.0.2
numpy==1.21.6
pandas==1.3.5
matplotlib==3.5.3
scikit-learn==1.0.2
tqdm==4.64.1




###############################
###############################
#   🏗️ 模型结构图 (HybridModel)
##     📊 输入数据
###############################
###############################

┌─────────────────┐    ┌──────────────────────┐
│  3D医学图像      │    │  放射组学特征         │
│  (1×64×64×64)   │    │  (n维特征向量)        │
└─────────────────┘    └──────────────────────┘
         │                       │
         ▼                       ▼

## 🖼️ 3D CNN分支 (图像特征提取)
┌─────────────────────────────────────────────┐
│ 卷积层1: 1→16通道, kernel=3, padding=1       │
│ StableBatchNorm3d + ReLU + MaxPool3d(2)     │
│ 输出: 16×32×32×32                           │
├─────────────────────────────────────────────┤
│ 卷积层2: 16→32通道, kernel=3, padding=1      │
│ StableBatchNorm3d + ReLU + MaxPool3d(2)     │
│ 输出: 32×16×16×16                           │
├─────────────────────────────────────────────┤
│ 卷积层3: 32→64通道, kernel=3, padding=1      │
│ StableBatchNorm3d + ReLU + MaxPool3d(2)     │
│ 输出: 64×8×8×8                              │
├─────────────────────────────────────────────┤
│ 卷积层4: 64→128通道, kernel=3, padding=1     │
│ StableBatchNorm3d + ReLU + MaxPool3d(2)     │
│ 输出: 128×4×4×4                             │
├─────────────────────────────────────────────┤
│ Flatten() → 128×4×4×4 = 8192维特征向量       │
└─────────────────────────────────────────────┘
         │
         ▼ 8192维

## 📈 放射组学分支 (特征处理)
┌─────────────────────────────────────────────┐
│ 全连接层1: n → 256                          │
│ StableBatchNorm1d + ReLU + Dropout(0.5)     │
├─────────────────────────────────────────────┤
│ 全连接层2: 256 → 128                        │
│ StableBatchNorm1d + ReLU                    │
│ 输出: 128维特征向量                          │
└─────────────────────────────────────────────┘
         │
         ▼ 128维

## 🔄 特征融合
         ┌───────────────┐
8192维 → │   特征拼接     │ → 8192 + 128 = 8320维
128维  → │ (Concatenate) │
         └───────────────┘
                 │
                 ▼ 8320维

## 🎯 分类器
┌─────────────────────────────────────────────┐
│ 全连接层3: 8320 → 256                       │
│ StableBatchNorm1d + ReLU + Dropout(0.5)     │
├─────────────────────────────────────────────┤
│ 全连接层4: 256 → 1                          │
│ Sigmoid激活 → 输出概率(0-1)                  │
└─────────────────────────────────────────────┘
                 │
                 ▼
           ┌─────────────┐
           │ 侵袭性概率   │
           │   (0-1)     │
           └─────────────┘


# 📋 数据流程总览

## 1. 📥 数据输入阶段
┌─────────────────────────────────────────────────┐
│ 从NIfTI文件加载3D图像 → 标准化 → 重采样到64×64×64 │
│ 从CSV文件加载放射组学特征 → 标准化处理            │
│ 从标签文件获取对应标签(0:非侵袭性, 1:侵袭性)     │
└─────────────────────────────────────────────────┘

## 2. 🔄 数据预处理流程
原始数据 → 数据增强(亮度/对比度/噪声) → 批量标准化 → 输入模型

## 3. 🎯 训练流程
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  前向传播    │ →  │  损失计算    │ →  │  反向传播    │
│ (Forward)   │    │ (BCELoss)   │    │ (Backward)  │
└─────────────┘    └─────────────┘    └─────────────┘
        ↑                                   │
        └───────────────────────────────────┘
                参数优化(Adam)

## 4. 📊 输出评估
┌─────────────────────────────────────────────────┐
│ 模型输出 → 概率值(0-1) → 阈值处理(0.5) → 预测标签 │
│ → 计算多种评估指标(AUC/Accuracy/F1/Precision/Recall) │
│ → 生成混淆矩阵和分类报告                         │
└─────────────────────────────────────────────────┘


# ⚡ 关键技术特点
## 🛡️ 稳定性处理
- StableBatchNorm3d: 处理3D卷积的小批量情况
- StableBatchNorm1d: 处理全连接层的小批量情况
- 自动跳过batch_size=1的训练批次

## 🔧 数据增强策略
- 随机亮度调整(0.8-1.2倍)
- 随机对比度调整(0.8-1.2倍)  
- 高斯噪声添加(概率0.5, 强度0.05)

## 📈 训练监控
- 实时进度条显示(tqdm)
- 多指标跟踪(损失/准确率/AUC/F1等)
- 学习率动态调整(ReduceLROnPlateau)
- 最佳模型保存机制

## 🎨 可视化功能
- 训练曲线可视化(6个子图)
- 混淆矩阵热力图
- 数据样本预览
- 中文标签支持
